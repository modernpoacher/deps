"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getInstallSaveBundleSaveExactCommands=getInstallSaveBundleSaveExactCommands;exports.getInstallSaveBundleCommands=getInstallSaveBundleCommands;exports.getInstallSaveOptionalSaveExactCommands=getInstallSaveOptionalSaveExactCommands;exports.getInstallSaveOptionalCommands=getInstallSaveOptionalCommands;exports.getInstallSaveDevSaveExactCommands=getInstallSaveDevSaveExactCommands;exports.getInstallSaveDevCommands=getInstallSaveDevCommands;exports.getInstallSaveProdSaveExactCommands=getInstallSaveProdSaveExactCommands;exports.getInstallSaveProdCommands=getInstallSaveProdCommands;exports.installSaveBundleSaveExact=installSaveBundleSaveExact;exports.installSaveBundle=installSaveBundle;exports.installSaveOptionalSaveExact=installSaveOptionalSaveExact;exports.installSaveOptional=installSaveOptional;exports.installSaveDevSaveExact=installSaveDevSaveExact;exports.installSaveDev=installSaveDev;exports.installSaveProdSaveExact=installSaveProdSaveExact;exports.installSaveProd=installSaveProd;exports.executeBundle=executeBundle;exports.executeOptional=executeOptional;exports.executeDev=executeDev;exports.executeProd=executeProd;exports.getInstallCommands=exports.getInstallSaveExactCommands=void 0;var _debug=_interopRequireDefault(require("debug"));var _os=require("os");var _child_process=require("child_process");var _common=require("./common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}const log=(0,_debug.default)('@modernpoacher/deps');log(`\`deps\` (${_os.platform}) is awake`);const getInstallSaveExactCommands=(p,c,r)=>{log('getInstallSaveExactCommands');const commands=`npm i ${(0,_common.transform)(p,c)}`;return(0,_common.normalise)((0,_common.getRegistryParameter)(r,(0,_common.getSaveExactParameter)(commands)));};exports.getInstallSaveExactCommands=getInstallSaveExactCommands;const getInstallCommands=(p,c,r)=>{log('getInstallCommands');const commands=`npm i ${(0,_common.transform)(p,c)}`;return(0,_common.normalise)((0,_common.getRegistryParameter)(r,commands));};exports.getInstallCommands=getInstallCommands;function getInstallSaveBundleSaveExactCommands(p,c,r){log('getInstallSaveBundleSaveExactCommands');const commands=getInstallSaveExactCommands(p,c,r);return(0,_common.normalise)((0,_common.getSaveBundleParameter)(commands));}function getInstallSaveBundleCommands(p,c,r){log('getInstallSaveBundleCommands');const commands=getInstallCommands(p,c,r);return(0,_common.normalise)((0,_common.getSaveBundleParameter)(commands));}function getInstallSaveOptionalSaveExactCommands(p,c,r){log('getInstallSaveOptionalSaveExactCommands');const commands=getInstallSaveExactCommands(p,c,r);return(0,_common.normalise)((0,_common.getSaveOptionalParameter)(commands));}function getInstallSaveOptionalCommands(p,c,r){log('getInstallSaveOptionalCommands');const commands=getInstallCommands(p,c,r);return(0,_common.normalise)((0,_common.getSaveOptionalParameter)(commands));}function getInstallSaveDevSaveExactCommands(p,c,r){log('getInstallSaveDevSaveExactCommands');const commands=getInstallSaveExactCommands(p,c,r);return(0,_common.normalise)((0,_common.getSaveDevParameter)(commands));}function getInstallSaveDevCommands(p,c,r){log('getInstallSaveDevCommands');const commands=getInstallCommands(p,c,r);return(0,_common.normalise)((0,_common.getSaveDevParameter)(commands));}function getInstallSaveProdSaveExactCommands(p,c,r){log('getInstallSaveProdSaveExactCommands');const commands=getInstallSaveExactCommands(p,c,r);return(0,_common.normalise)((0,_common.getSaveProdParameter)(commands));}function getInstallSaveProdCommands(p,c,r){log('getInstallSaveProdCommands');const commands=getInstallCommands(p,c,r);return(0,_common.normalise)((0,_common.getSaveProdParameter)(commands));}function installSaveBundleSaveExact(d,p,c,r){log('installSaveBundleSaveExact');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallSaveBundleSaveExactCommands(p,c,r));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveBundle(d,p,c,r){log('installSaveBundle');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallSaveBundleCommands(p,c,r));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveOptionalSaveExact(d,p,c,r){log('installSaveOptionalSaveExact');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallSaveOptionalSaveExactCommands(p,c,r));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveOptional(d,p,c,r){log('installSaveOptional');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallSaveOptionalCommands(p,c,r));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveDevSaveExact(d,p,c,r){log('installSaveDevSaveExact');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallSaveDevSaveExactCommands(p,c,r));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveDev(d,p,c,r){log('installSaveDev');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallSaveDevCommands(p,c,r));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveProdSaveExact(d,p,c,r){log('installSaveProdSaveExact');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallSaveProdSaveExactCommands(p,c,r));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveProd(d,p,c,r){log('installSaveProd');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallSaveProdCommands(p,c,r));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}async function executeBundle(directory=_common.DIRECTORY,packages={},configuration={},registry=_common.REGISTRY){log('executeBundle');const depsSaveExact=(0,_common.getDepsExact)(packages,configuration);if(depsSaveExact.length)await installSaveBundleSaveExact(directory,depsSaveExact,configuration,registry);const deps=(0,_common.getDeps)(packages);if(deps.length)await installSaveBundle(directory,deps,configuration,registry);}async function executeOptional(directory=_common.DIRECTORY,packages={},configuration={},registry=_common.REGISTRY){log('executeOptional');const depsSaveExact=(0,_common.getDepsExact)(packages,configuration);if(depsSaveExact.length)await installSaveOptionalSaveExact(directory,depsSaveExact,configuration,registry);const deps=(0,_common.getDeps)(packages);if(deps.length)await installSaveOptional(directory,deps,configuration,registry);}async function executeDev(directory=_common.DIRECTORY,packages={},configuration={},registry=_common.REGISTRY){log('executeDev');const depsSaveExact=(0,_common.getDepsExact)(packages,configuration);if(depsSaveExact.length)await installSaveDevSaveExact(directory,depsSaveExact,configuration,registry);const deps=(0,_common.getDeps)(packages);if(deps.length)await installSaveDev(directory,deps,configuration,registry);}async function executeProd(directory=_common.DIRECTORY,packages={},configuration={},registry=_common.REGISTRY){log('executeProd');const depsSaveExact=(0,_common.getDepsExact)(packages,configuration);if(depsSaveExact.length)await installSaveProdSaveExact(directory,depsSaveExact,configuration,registry);const deps=(0,_common.getDeps)(packages);if(deps.length)await installSaveProd(directory,deps,configuration,registry);}