"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getSaveBundleCommands=getSaveBundleCommands;exports.getSaveOptionalCommands=getSaveOptionalCommands;exports.getSaveDevCommands=getSaveDevCommands;exports.getSaveProdCommands=getSaveProdCommands;exports.installSaveBundleExact=installSaveBundleExact;exports.installSaveBundle=installSaveBundle;exports.installSaveOptionalExact=installSaveOptionalExact;exports.installSaveOptional=installSaveOptional;exports.installSaveDevExact=installSaveDevExact;exports.installSaveDev=installSaveDev;exports.installSaveProdExact=installSaveProdExact;exports.installSaveProd=installSaveProd;exports.executeBundle=executeBundle;exports.executeOptional=executeOptional;exports.executeDev=executeDev;exports.executeProd=executeProd;exports.getCommands=void 0;var _debug=_interopRequireDefault(require("debug"));var _child_process=require("child_process");var _common=require("./common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}const log=(0,_debug.default)('@modernpoacher/deps');log('`deps` is awake');const getCommands=(v,c,r,e)=>['install'].concat((0,_common.transform)(v,c)).concat(r?['--registry',r]:[]).concat(e?'--save-exact':[]);exports.getCommands=getCommands;function getSaveBundleCommands(v,c,r,e=false){log('getSaveBundleCommands');return getCommands(v,c,r,e).concat('--save-bundle');}function getSaveOptionalCommands(v,c,r,e=false){log('getSaveOptionalCommands');return getCommands(v,c,r,e).concat('--save-optional');}function getSaveDevCommands(v,c,r,e=false){log('getSaveDevCommands');return getCommands(v,c,r,e).concat('--save-dev');}function getSaveProdCommands(v,c,r,e=false){log('getSaveProdCommands');return getCommands(v,c,r,e).concat('--save-prod');}function installSaveBundleExact(d,v,c,r){log('installSaveBundleExact');return new Promise((resolve,reject)=>{const commands=getSaveBundleCommands(v,c,r,true);(0,_child_process.spawn)(`cd '${d}' && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveBundle(d,v,c,r){log('installSaveBundle');return new Promise((resolve,reject)=>{const commands=getSaveBundleCommands(v,c,r);(0,_child_process.spawn)(`cd '${d}' && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveOptionalExact(d,v,c,r){log('installSaveOptionalExact');return new Promise((resolve,reject)=>{const commands=getSaveOptionalCommands(v,c,r,true);(0,_child_process.spawn)(`cd '${d}' && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveOptional(d,v,c,r){log('installSaveOptional');return new Promise((resolve,reject)=>{const commands=getSaveOptionalCommands(v,c,r);(0,_child_process.spawn)(`cd '${d}' && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveDevExact(d,v,c,r){log('installSaveDevExact');return new Promise((resolve,reject)=>{const commands=getSaveDevCommands(v,c,r,true);(0,_child_process.spawn)(`cd '${d}' && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveDev(d,v,c,r){log('installSaveDev');return new Promise((resolve,reject)=>{const commands=getSaveDevCommands(v,c,r);(0,_child_process.spawn)(`cd '${d}' && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveProdExact(d,v,c,r){log('installSaveProdExact');return new Promise((resolve,reject)=>{const commands=getSaveProdCommands(v,c,r,true);(0,_child_process.spawn)(`cd '${d}' && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function installSaveProd(d,v,c,r){log('installSaveProd');return new Promise((resolve,reject)=>{const commands=getSaveProdCommands(v,c,r);(0,_child_process.spawn)(`cd '${d}' && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}async function executeBundle(directory='.',packages={},configuration={},registry){log('executeBundle');const depsExact=(0,_common.getDepsExact)(packages,configuration);if(depsExact.length)await installSaveBundleExact(directory,depsExact,configuration,registry);const deps=(0,_common.getDeps)(packages);if(deps.length)await installSaveBundle(directory,deps,configuration,registry);}async function executeOptional(directory='.',packages={},configuration={},registry){log('executeOptional');const depsExact=(0,_common.getDepsExact)(packages,configuration);if(depsExact.length)await installSaveOptionalExact(directory,depsExact,configuration,registry);const deps=(0,_common.getDeps)(packages);if(deps.length)await installSaveOptional(directory,deps,configuration,registry);}async function executeDev(directory='.',packages={},configuration={},registry){log('executeDev');const depsExact=(0,_common.getDepsExact)(packages,configuration);if(depsExact.length)await installSaveDevExact(directory,depsExact,configuration,registry);const deps=(0,_common.getDeps)(packages);if(deps.length)await installSaveDev(directory,deps,configuration,registry);}async function executeProd(directory='.',packages={},configuration={},registry){log('executeProd');const depsExact=(0,_common.getDepsExact)(packages,configuration);if(depsExact.length)await installSaveProdExact(directory,depsExact,configuration,registry);const deps=(0,_common.getDeps)(packages);if(deps.length)await installSaveProd(directory,deps,configuration,registry);}