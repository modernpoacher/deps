"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.executeEachBundle=executeEachBundle;exports.executeEachOptional=executeEachOptional;exports.executeEachDev=executeEachDev;exports.executeEach=executeEach;exports.executeProd=exports.executeDev=exports.executeOptional=exports.executeBundle=void 0;var _child_process=require("child_process");var _debug=_interopRequireDefault(require("debug"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}const log=(0,_debug.default)('deps');const getDepsExact=v=>Object.entries(v).reduce((accumulator,[module,version])=>/^\d/.test(version)?accumulator.concat(module):accumulator,[]);const getDeps=v=>Object.entries(v).reduce((accumulator,[module,version])=>/^\d/.test(version)?accumulator:accumulator.concat(module),[]);const transform=v=>Array.isArray(v)?v.map(s=>s.trim().concat('@latest')).join(String.fromCharCode(32)).trim():v.concat('@latest');const getCommands=(v,r,e)=>['install'].concat(transform(v)).concat(r?['--registry',r]:[]).concat(e?'--save-exact':[]);const getSaveBundleCommands=(v,r,e=false)=>getCommands(v,r,e).concat('--save-bundle');const getSaveOptionalCommands=(v,r,e=false)=>getCommands(v,r,e).concat('--save-optional');const getSaveDevCommands=(v,r,e=false)=>getCommands(v,r,e).concat('--save-dev');const getSavProdCommands=(v,r,e=false)=>getCommands(v,r,e).concat('--save-prod');const installSaveBundleExact=(d,v,r)=>new Promise((resolve,reject)=>{const commands=getSaveBundleCommands(v,r,true);log(commands.join(String.fromCharCode(32)).trim());(0,_child_process.spawn)(`cd "${d}" && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});const installSaveBundle=(d,v,r)=>new Promise((resolve,reject)=>{const commands=getSaveBundleCommands(v,r);log(commands.join(String.fromCharCode(32)).trim());(0,_child_process.spawn)(`cd "${d}" && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});const installSaveOptionalExact=(d,v,r)=>new Promise((resolve,reject)=>{const commands=getSaveOptionalCommands(v,r,true);log(commands.join(String.fromCharCode(32)).trim());(0,_child_process.spawn)(`cd "${d}" && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});const installSaveOptional=(d,v,r)=>new Promise((resolve,reject)=>{const commands=getSaveOptionalCommands(v,r);log(commands.join(String.fromCharCode(32)).trim());(0,_child_process.spawn)(`cd "${d}" && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});const installSaveDevExact=(d,v,r)=>new Promise((resolve,reject)=>{const commands=getSaveDevCommands(v,r,true);log(commands.join(String.fromCharCode(32)).trim());(0,_child_process.spawn)(`cd "${d}" && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});const installSaveDev=(d,v,r)=>new Promise((resolve,reject)=>{const commands=getSaveDevCommands(v,r);log(commands.join(String.fromCharCode(32)).trim());(0,_child_process.spawn)(`cd "${d}" && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});const installSaveProdExact=(d,v,r)=>new Promise((resolve,reject)=>{const commands=getSavProdCommands(v,r,true);log(commands.join(String.fromCharCode(32)).trim());(0,_child_process.spawn)(`cd "${d}" && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});const installSaveProd=(d,v,r)=>new Promise((resolve,reject)=>{const commands=getSavProdCommands(v,r);log(commands.join(String.fromCharCode(32)).trim());(0,_child_process.spawn)(`cd "${d}" && npm`,commands,{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});async function executeEachBundle(dir='.',[entry,...array]=[],registry){const[module,version]=entry;if(module){if(/^\d/.test(version)){await installSaveBundleExact(dir,entry,registry);}else{await installSaveBundle(dir,entry,registry);}}return array.length?executeEachBundle(dir,array,registry):array;}async function executeEachOptional(dir='.',[entry,...array]=[],registry){const[module,version]=entry;if(module){if(/^\d/.test(version)){await installSaveOptionalExact(dir,entry,registry);}else{await installSaveOptional(dir,entry,registry);}}return array.length?executeEachOptional(dir,array,registry):array;}async function executeEachDev(dir='.',[entry,...array]=[],registry){const[module,version]=entry;if(module){if(/^\d/.test(version)){await installSaveDevExact(dir,entry,registry);}else{await installSaveDev(dir,entry,registry);}}return array.length?executeEachDev(dir,array,registry):array;}async function executeEach(dir='.',[entry,...array]=[],registry){const[module,version]=entry;log(module,version,entry);if(module){if(/^\d/.test(version)){await installSaveProdExact(dir,entry,registry);}else{await installSaveProd(dir,entry,registry);}}return array.length?executeEach(dir,array,registry):array;}const executeBundle=async(dir='.',dependencies={},registry)=>{const depsExact=getDepsExact(dependencies);const deps=getDeps(dependencies);if(depsExact.length)await installSaveBundleExact(dir,depsExact,registry);if(deps.length)await installSaveBundle(dir,deps,registry);};exports.executeBundle=executeBundle;const executeOptional=async(dir='.',dependencies={},registry)=>{const depsExact=getDepsExact(dependencies);const deps=getDeps(dependencies);if(depsExact.length)await installSaveOptionalExact(dir,depsExact,registry);if(deps.length)await installSaveOptional(dir,deps,registry);};exports.executeOptional=executeOptional;const executeDev=async(dir='.',dependencies={},registry)=>{const depsExact=getDepsExact(dependencies);const deps=getDeps(dependencies);if(depsExact.length)await installSaveDevExact(dir,depsExact,registry);if(deps.length)await installSaveDev(dir,deps,registry);};exports.executeDev=executeDev;const executeProd=async(dir='.',dependencies={},registry)=>{const depsExact=getDepsExact(dependencies);const deps=getDeps(dependencies);if(depsExact.length)await installSaveProdExact(dir,depsExact,registry);if(deps.length)await installSaveProd(dir,deps,registry);};exports.executeProd=executeProd;