"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.installSaveExact=installSaveExact;exports.install=install;exports.execute=execute;exports.getInstallCommands=exports.getInstallSaveExactCommands=void 0;var _child_process=require("child_process");var _debug=_interopRequireDefault(require("debug"));var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}const log=(0,_debug.default)('@modernpoacher/deps:install');log('`install` is awake');const getInstallSaveExactCommands=(p,c,s,r)=>{log('getInstallSaveExactCommands');const commands=`npm i ${(0,_common.transform)(p,c)}`;return(0,_common.normalise)((0,_common.getNoSaveParameter)(s,(0,_common.getRegistryParameter)(r,(0,_common.getSaveExactParameter)(commands))));};exports.getInstallSaveExactCommands=getInstallSaveExactCommands;const getInstallCommands=(p,c,s,r)=>{log('getInstallCommands');const commands=`npm i ${(0,_common.transform)(p,c)}`;return(0,_common.normalise)((0,_common.getNoSaveParameter)(s,(0,_common.getRegistryParameter)(r,commands)));};exports.getInstallCommands=getInstallCommands;function installSaveExact(d,p,c,s,r){log('installSaveExact');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallSaveExactCommands(p,c,s,r,true));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}function install(d,p,c,s,r){log('install');return new Promise((resolve,reject)=>{const commands=(0,_common.getCommands)(d,getInstallCommands(p,c,s,r));(0,_child_process.spawn)('/bin/bash',['-c',commands],{shell:true,stdio:'inherit'},e=>!e?resolve():reject(e)).on('close',resolve).on('error',reject);});}async function execute(directory=_common.DIRECTORY,packages={},configuration={},save=false,registry=_common.REGISTRY){log('execute');const depsExact=(0,_common.getDepsExact)(packages,configuration);if(depsExact.length)await installSaveExact(directory,depsExact,configuration,save,registry);const deps=(0,_common.getDeps)(packages);if(deps.length)await install(directory,deps,configuration,save,registry);}